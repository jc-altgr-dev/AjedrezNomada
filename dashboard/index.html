<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Entrenamiento Ajedrez</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background: #2c3e50;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 1rem;
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    label { display: block; margin-top: 0.5rem; }
    input, select, button {
      padding: 0.5rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
    }
    button {
      background: #3498db;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #2980b9; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 1rem;
    }
    th, td {
      padding: 0.5rem; border: 1px solid #ccc; text-align: center;
    }
    th { background: #3498db; color: white; }
    canvas { max-width: 100%; }
    .logout-btn {
      background: #e74c3c; margin-top: 1rem;
    }
    /* RESPONSIVO */
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      th { display: none; }
      td {
        border: none;
        padding: 0.5rem;
        position: relative;
      }
      td::before {
        content: attr(data-label);
        font-weight: bold;
        display: block;
        margin-bottom: 0.3rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>📊 Dashboard de Entrenamiento</h1>
  </header>
  <div class="container">

    <!-- LOGIN -->
    <div class="card" id="login-card">
      <h2>Iniciar sesión</h2>
      <label>Nombre del jugador:</label>
      <input type="text" id="playerName" placeholder="Escribe tu nombre">
      <button onclick="login()">Entrar</button>
    </div>

    <!-- REGISTRO -->
    <div class="card" id="training-card" style="display:none;">
      <h2 id="welcome"></h2>
      <label>Área de entrenamiento:</label>
      <select id="trainingArea">
        <option value="Coordenadas">Coordenadas</option>
        <option value="Racer">Racer</option>
        <option value="Storm">Storm</option>
        <option value="Streak">Streak</option>
        <option value="Matein1">Mate in 1</option>
        <option value="Matein2">Mate in 2</option>
        <option value="Matein3">Mate in 3</option>
        <option value="Matein4">Mate in 4</option>
        <option value="Matein5+">Mate in 5+</option>
        <option value="Puzzles">Puzzles</option>
      </select>
      <label>Puntuación obtenida:</label>
      <input type="number" id="score" placeholder="Ej. 30">
      <button onclick="addRecord()">Registrar</button>
      <button class="logout-btn" onclick="logout()">Finalizar entrenamiento</button>
    </div>

    <!-- TABLA -->
    <div class="card" id="records-card" style="display:none;">
      <h2>Registros</h2>
      <table id="recordsTable">
        <thead>
          <tr>
            <th>Jugador</th>
            <th>Área</th>
            <th>Puntuación</th>
            <th>Promedio</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- GRAFICA -->
    <div class="card" id="chart-card" style="display:none;">
      <h2>Gráfica de Progresos</h2>
      <canvas id="progressChart"></canvas>
      <button onclick="exportPDF()">📄 Exportar a PDF</button>
    </div>

  </div>

<script>
  let currentPlayer = null;
  let records = JSON.parse(localStorage.getItem("records")) || [];
  let chart;

  function login() {
    const name = document.getElementById("playerName").value.trim();
    if (!name) return alert("Escribe un nombre válido.");
    currentPlayer = name;
    document.getElementById("login-card").style.display = "none";
    document.getElementById("training-card").style.display = "block";
    document.getElementById("records-card").style.display = "block";
    document.getElementById("chart-card").style.display = "block";
    document.getElementById("welcome").innerText = "Jugador: " + name;
    updateTable();
    updateChart();
  }

  function logout() {
    currentPlayer = null;
    document.getElementById("login-card").style.display = "block";
    document.getElementById("training-card").style.display = "none";
    document.getElementById("records-card").style.display = "none";
    document.getElementById("chart-card").style.display = "none";
  }

  function addRecord() {
    if (!currentPlayer) return alert("Inicia sesión primero.");
    const area = document.getElementById("trainingArea").value;
    const score = parseInt(document.getElementById("score").value);
    if (isNaN(score)) return alert("Ingresa una puntuación válida.");
    records.push({ player: currentPlayer, area, score });
    localStorage.setItem("records", JSON.stringify(records));
    document.getElementById("score").value = "";
    updateTable();
    updateChart();
  }

  function calculateAverage(player, area) {
    const filtered = records.filter(r => r.player === player && r.area === area);
    const sum = filtered.reduce((acc, r) => acc + r.score, 0);
    return (sum / filtered.length).toFixed(2);
  }

  function updateTable() {
    const tbody = document.querySelector("#recordsTable tbody");
    tbody.innerHTML = "";
    records.filter(r => r.player === currentPlayer).forEach(r => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Jugador">${r.player}</td>
        <td data-label="Área">${r.area}</td>
        <td data-label="Puntuación">${r.score}</td>
        <td data-label="Promedio">${calculateAverage(r.player, r.area)}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function updateChart() {
    const ctx = document.getElementById("progressChart").getContext("2d");
    const areas = [...new Set(records.filter(r => r.player === currentPlayer).map(r => r.area))];
    const avgScores = areas.map(area => calculateAverage(currentPlayer, area));

    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: areas,
        datasets: [{
          label: "Promedio",
          data: avgScores,
          backgroundColor: "rgba(52, 152, 219, 0.6)",
          borderColor: "#2980b9",
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  }

  async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Reporte de Entrenamiento - " + currentPlayer, 10, 10);
    let y = 20;
    records.filter(r => r.player === currentPlayer).forEach(r => {
      doc.text(`${r.area}: ${r.score} (Prom: ${calculateAverage(r.player, r.area)})`, 10, y);
      y += 10;
    });
    doc.save(`reporte_${currentPlayer}.pdf`);
  }
</script>
</body>
</html>

