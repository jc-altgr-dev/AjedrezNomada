<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Chess Problems Simple</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f0f0; }
        #board { width: 400px; margin: 20px 0; }
        .controls { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); width: 400px; }
        .nav-buttons { display: flex; justify-content: space-between; margin: 10px 0; }
        .info { margin-bottom: 10px; font-weight: bold; text-align: center; }
        select, input, button { padding: 5px; cursor: pointer; }
        .search-box { margin-top: 10px; display: flex; gap: 5px; border-top: 1px solid #eee; pt: 10px; }
    </style>
</head>
<body>

    <div id="board"></div>

    <div class="controls">
        <div id="problem-info" class="info">Cargando...</div>
        
        <div class="nav-buttons">
            <button onclick="prevProblem()">◀ Anterior</button>
            <button onclick="nextProblem()">Siguiente ▶</button>
        </div>

        <div style="margin: 10px 0;">
            <label>Piezas:</label>
            <select id="pieceStyle" onchange="changeTheme()">
                <option value="local">Locales (Estándar)</option>
                <option value="wikipedia">Wikipedia</option>
            </select>
        </div>

        <div class="search-box">
            <input type="number" id="searchId" placeholder="ID del problema...">
            <button onclick="searchById()">Buscar</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script>
        const data = {
            "problems": [
                {"problemid":1,"first":"White to Move","type":"Mate in One","fen":"3q1rk1/5pbp/5Qp1/8/8/2B5/5PPP/6K1 w - - 0 1","moves":"f6-g7"},
                {"problemid":2,"first":"White to Move","type":"Mate in One","fen":"2r2rk1/2q2p1p/6pQ/4P1N1/8/8/PPP5/2KR4 w - - 0 1","moves":"h6-h7"},
                {"problemid":3,"first":"White to Move","type":"Mate in One","fen":"r2q1rk1/pp1p1p1p/5PpQ/8/4N3/8/PP3PPP/R5K1 w - - 0 1","moves":"h6-g7"},
                {"problemid":4460,"first":"Black to Move","type":"Mate in Three","fen":"r1b2r1k/pp4pB/6Q1/3p2N1/2n5/1N2P1P1/PP3q1P/2R4K b - - 0 1","moves":"f2-f1;c1-f1;f8-f1;h1-g2;c4-e3"},
                {"problemid":4461,"first":"Black to Move","type":"Mate in Three","fen":"6rr/1b2k3/p2pp3/1p2bP1P/6P1/1PNB3K/1PP5/3R1R2 b - - 0 1","moves":"h8-h5;g4-h5;b7-g2;h3-h4;e5-f6"},
                {"problemid":4462,"first":"Black to Move","type":"Mate in Three","fen":"r1b4k/ppn3pp/8/3p4/P2PP2q/1Q2BP2/NP2nNK1/2R2R2 b - - 0 1","moves":"c8-h3;f2-h3;h4-g3;g2-h1;g3-h3"}
            ]
        };

        let currentIndex = 0;
        let board = null;

        // Configuración de temas de piezas
        function pieceTheme(piece) {
            const style = document.getElementById('pieceStyle').value;
            if (style === 'wikipedia') {
                const map = {
                    'wP': '0/04', 'wN': '2/28', 'wB': 'b/b8', 'wR': '7/72', 'wQ': '5/59', 'wK': '4/42',
                    'bP': 'c/c7', 'bN': 'f/f0', 'bB': '9/98', 'bR': 'f/ff', 'bQ': '4/47', 'bK': 'f/f0'
                };
                // Nota: Wikipedia usa una estructura de carpetas compleja, esta es la forma simplificada de las URLs comunes:
                return `https://upload.wikimedia.org/wikipedia/commons/${map[piece]}/${piece}.png`;
            }
            // Por defecto: Local/Chesboardjs CDN
            return 'https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/img/chesspieces/wikipedia/' + piece + '.png';
        }

        function loadProblem(index) {
            currentIndex = index;
            const p = data.problems[currentIndex];
            
            document.getElementById('problem-info').innerText = 
                `ID: ${p.problemid} - ${p.type} (${p.first})`;

            const config = {
                position: p.fen,
                draggable: true,
                pieceTheme: pieceTheme
            };
            
            if (board) board.destroy();
            board = Chessboard('board', config);
            
            // Orientar el tablero según quién mueve
            board.orientation(p.first.toLowerCase().includes('white') ? 'white' : 'black');
        }

        function nextProblem() {
            if (currentIndex < data.problems.length - 1) loadProblem(currentIndex + 1);
        }

        function prevProblem() {
            if (currentIndex > 0) loadProblem(currentIndex - 1);
        }

        function searchById() {
            const id = parseInt(document.getElementById('searchId').value);
            const foundIndex = data.problems.findIndex(p => p.problemid === id);
            if (foundIndex !== -1) {
                loadProblem(foundIndex);
            } else {
                alert("Problema no encontrado");
            }
        }

        function changeTheme() {
            loadProblem(currentIndex);
        }

        // Inicio inicial
        loadProblem(0);

    </script>
</body>
</html>
